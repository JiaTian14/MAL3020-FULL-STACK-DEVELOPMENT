<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - TechMart</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Header Styles */
    header {
      background-color: #2d6a4f;
      padding: 1rem;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo h1 {
      color: white;
      font-size: 1.8rem;
      font-weight: 600;
    }

    .logo i {
      color: #fff;
      font-size: 2rem;
    }

    .header-nav {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .nav-links {
      display: flex;
      gap: 20px;
      list-style: none;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      padding: 8px 15px;
      border-radius: 4px;
      transition: background-color 0.3s;
    }

    .nav-links a:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .auth-buttons a {
      padding: 8px 20px;
      border-radius: 4px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s;
    }

    .login-btn {
      color: #2d6a4f;
      background-color: white;
    }

    .register-btn {
      color: white;
      border: 1px solid white;
      margin-left: 10px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 400px;
    }

    .logo-section {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo-section i {
      font-size: 2.5rem;
      color: #2d6a4f;
      margin-bottom: 10px;
    }

    h1 {
      text-align: center;
      color: #2d6a4f;
      font-size: 1.8rem;
      margin-bottom: 30px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #495057;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #2d6a4f;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: #2d6a4f;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #235c3f;
    }

    .register-link {
      text-align: center;
      margin-top: 20px;
      color: #6c757d;
    }

    .register-link a {
      color: #2d6a4f;
      text-decoration: none;
      font-weight: 500;
    }

    .register-link a:hover {
      text-decoration: underline;
    }

    .error-message {
      display: none;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      text-align: center;
    }

    .success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .user-profile {
      display: none;
      text-align: center;
    }

    .user-profile img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin-bottom: 15px;
    }

    .user-details {
      margin-top: 20px;
    }

    .user-details p {
      margin: 8px 0;
      color: #495057;
    }

    .logout-btn {
      background-color: #dc3545;
      margin-top: 20px;
    }

    .logout-btn:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>
    <header>
      <div class="header-container">
        <div class="logo">
          <a href="index.html" style="text-decoration: none; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-shopping-bag"></i>
              <h1>TechMart</h1>
          </a>
        </div>
        <nav class="header-nav">
          <ul class="nav-links">
            <li><a href="products.html">Products</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="profile.html">Profile</a></li>
            <li><a href="cart.html">Cart</a></li>
          </ul>
          <div class="auth-buttons">
            <a href="login.html" class="login-btn">Login</a>
            <a href="register.html" class="register-btn">Register</a>
            <a href="clientlogin.html" class="login-btn">Seller Login</a>
          </div>
        </nav>
      </div>
    </header>
  <div class="container">
    <!-- Login Form -->
    <div id="loginForm">
      <div class="logo-section">
        <i class="fas fa-shopping-bag"></i>
        <h1>Welcome Back</h1>
      </div>

      <form id="loginFormElement">
        <div class="input-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required>
        </div>

        <div class="input-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required>
        </div>

        <button type="submit">Login</button>
      </form>

      <p class="register-link">
        Don't have an account? <a href="register.html">Register here</a>
      </p>

      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>
    </div>

    <!-- User Profile (Hidden by default) -->
    <div id="userProfile" class="user-profile">
      <img id="userAvatar" src="data:image/jpeg;base64,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" alt="User Avatar">
      <h2 id="userName">Welcome, User</h2>
      <div class="user-details">
        <p>Email: <span id="userEmail"></span></p>
        <p>Member since: <span id="userJoinDate"></span></p>
      </div>
      <button onclick="logout()" class="logout-btn">Logout</button>
    </div>
  </div>
<!-- Success message -->
<div id="successMessage" style="display:none; color:green;"></div>

<!-- Error message -->
<div id="errorMessage" style="display:none; color:red;"></div>

  <script src="script.js"></script>
  
  <script>
    async function handleLogin(event) {
        event.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        try {
            const response = await fetch('http://localhost:3000/api/users/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            });

            const result = await response.json();

            console.log('Login response:', result); // 调试用

            if (result.success) {
                // 确保保存完整的用户数据，包括 userId
                localStorage.setItem('userData', JSON.stringify({

                    _id: result.data.userId, // 注意这里使用 _id
                    username: result.data.username,
                    email: result.data.email
                }));
                const successMessage = document.getElementById('successMessage');
                successMessage.textContent = 'Login successful! Redirecting...';
                successMessage.style.display = 'block';

                

                // Redirect after short delay
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            }
                
            
        } catch (error) {
            console.error('Login error:', error);
            if (errorMessage) {
                errorMessage.textContent = 'An error occurred during login';
                errorMessage.style.display = 'block';
            } else {
                alert('An error occurred during login');
            }
        }
    }

    // Add event listener to form
    const loginForm = document.getElementById('loginForm');
    if (loginForm) {
        loginForm.addEventListener('submit', handleLogin);
    }

    function showUserProfile(user) {
        if (!user) return;

        // 隐藏登录表单，显示用户信息
        loginFormDiv.style.display = 'none';
        userProfileDiv.style.display = 'block';

        // 更新用户信息
        document.getElementById('userName').textContent = `Welcome, ${user.username}`;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userJoinDate').textContent = new Date(user.createdAt).toLocaleDateString();
    }

    function logout() {
      localStorage.removeItem('userData');
      window.location.reload(); // 刷新页面以显示登录表单
    }

    // 页面加载时检查登录状态
    document.addEventListener('DOMContentLoaded', () => {
      const loginFormDiv = document.getElementById('loginForm');
      const userProfileDiv = document.getElementById('userProfile');
      const savedUserData = localStorage.getItem('userData');
      if (savedUserData) {
        try {
          const userData = JSON.parse(savedUserData);
          // 隐藏登录表单，显示用户信息

          loginFormDiv.style.display = 'none';
          userProfileDiv.style.display = 'block';

          // 更新用户信息
          document.getElementById('userName').textContent = `Welcome, ${userData.username}`;
          document.getElementById('userEmail').textContent = userData.email;

          const registrationDate = new Date(userData.createdAt).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
          });
          document.getElementById('userJoinDate').textContent = registrationDate;

          // 更新顶部导航栏的按钮

          const authButtons = document.querySelector('.auth-buttons');
          authButtons.innerHTML = `
            <a href="#" onclick="logout()" class="login-btn">Logout</a>
          `;

        } catch (error) {
          console.error('Error loading saved user data:', error);
          localStorage.removeItem('userData');
        }
      }
    });
  </script>
</body>
</html>